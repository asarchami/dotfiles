#!/bin/bash

# This script installs yazi and its dependencies
# Works across macOS (Homebrew), Arch Linux (yay/pacman), and other Linux (Linuxbrew)

# Source helper functions from chezmoi source directory
HELPERS_PATH="{{ .chezmoi.sourceDir }}/.install-helpers.sh"
if [ -f "$HELPERS_PATH" ]; then
    source "$HELPERS_PATH"
else
    echo "Error: Helper functions not found at $HELPERS_PATH"
    exit 1
fi

echo "ðŸš€ Installing yazi and its dependencies..."

# Core yazi
install_package "yazi" "yazi" "yazi"

# File utilities
install_package "fd" "fd" "fd"
install_package "ripgrep" "ripgrep" "rg"
install_package "fzf" "fzf" "fzf"
install_package "zoxide" "zoxide" "zoxide"

# Media tools
install_package "ffmpeg" "ffmpeg" "ffmpeg"
install_package "sevenzip" "p7zip" "7z"
install_package "jq" "jq" "jq"
install_package "poppler" "poppler" "pdfinfo"
install_package "imagemagick" "imagemagick" "convert"
install_package "resvg" "resvg" "resvg"

# Fonts (GUI only)
PKG_MANAGER=$(detect_package_manager)
if [[ "$PKG_MANAGER" == "brew" ]]; then
    install_package "font-symbols-only-nerd-font" "" ""
elif [[ "$PKG_MANAGER" == "yay" ]] || [[ "$PKG_MANAGER" == "pacman" ]]; then
    install_package "" "ttf-nerd-fonts-symbols" ""
fi

echo "âœ… Yazi dependencies installation complete!"
